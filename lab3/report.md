# 编译原理实验3实验报告


组长：王齐剑 221900059

组员：晁宇豪 221240013 高歌 221240075

## 实验进度

完成必做内容

完成所有选作内容

## 实验亮点

1. 结构体字段偏移量的精确计算
实现了`getStructFieldOffset`函数来精确计算结构体成员的字节偏移量。该函数根据结构体类型定义遍历字段列表，累计前序字段的大小，从而计算出目标字段的准确内存位置。这确保了对结构体成员的访问能够正确生成中间代码，避免了硬编码偏移值带来的错误。

2. 系统调用的特殊处理机制
为` read() `和 `write()` 这样的系统调用实现了特殊的处理逻辑，而不是将它们作为普通函数调用处理。这种方法生成了更高效的中间代码（直接使用 READ 和 WRITE 指令），并且允许后续优化阶段对这些操作进行特殊处理。

```C
if (!strcmp(func_name, "read")) {
    // 直接生成READ指令而不是函数调用
    pInstruction readInstr = newInstruction(READ);
    readInstr->u.singleop.op = place;
    appendInstruction(readInstr);
    return; // 避免生成CALL指令
}
```

3. 控制流结构的灵活转换
这是本次实验中架构设计的最为精妙之处，我们实现了一套完整的控制流（`if-else`, `while`）转换机制，使用标签和跳转指令正确表达高级语言的控制结构。特别是条件表达式的处理，通过 translateCond 函数将复杂的布尔表达式（包括 AND、OR 逻辑）转换为基于标签的控制流图，这为后续优化提供了良好基础。

## 实验感想

在完成实验的过程中修复了lab2的一个bug，前期埋坑真的隐患无穷。